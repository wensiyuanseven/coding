<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Document</title>
    </head>

    <body>
        <a onclick="go('/home')">首页</a>
        <a onclick="go('/about')">关于</a>
        <div id="html"></div>
        <script>
            // https://www.renfei.org/blog/html5-introduction-3-history-api.html
            // 为什么不能用本地图片 因为收到了跨域限制 file协议不支持跨域
            // cannot be created in a document with origin 'null'
            // 为什么在本地打开会报错？
            // 本地原地址是 file:///Users/siyuan/Desktop/coding/%E8%B7%AF%E7%94%B1/history%E6%A8%A1%E5%BC%8F.html
            // 用pushState更改后的地址是 file:///about  报的错为 cannot be created in a document with origin 'null'
            // 意思是 不能在源为“null”的文档中创建  也就是源头不存在 所以会报错（个人理解：同源策略必须在http协议下才生效，而现在是file协议）
            // 为什么服务器上打开不会报错？
            // mdn说 新网址必须与当前网址相同 origin； 否则，pushState()将引发异常 ,所以在服务器上切换时是遵循同源策略的，不会报错。
            // 但是再切换路由之后再刷新浏览器就会报错，因为服务器并没有此/about路径,会报404，如果是vue-cli(会直接回到首页)
            // 为什么webpack项目打开此文件不会报错？
            // 因为 webpack-dev-server 内部帮你处理过了 当你访问时对应的路由会去找对应的组件
            // http://127.0.0.1:5501/路由/
            function go(pathname) {
                const state = { id_1: 1, id_2: 5 }; //传给popstate参数
                const title = "我是标题"; // 无效
                history.pushState(state, title, pathname); // 向栈中添加历史记录
                html.innerHTML = pathname;
            }
            console.log(document.URL, "--==------");
            // setTimeout(() => {
            // history.pushState(null, null, "/dddd"); // todo 向栈中添加历史记录
            // }, 3000);
            window.addEventListener("load", () => {
                console.log(window.history, "----");
                // this.history.current = location.hash.slice(1);
            });

            // 监听后退按钮和前进按钮   History.pushState()和 History.replaceState()不会触发popstate此事件
            // 但是History.go()和History.back()等，
            // 虽然可以触发popstate事件，但是都会刷新页面，我们在单页应用中使用的是replaceState和pushState，因此这里还有一个等待解决的问题：
            // 如何监听replaceState和pushState行为呢？ 参考 https://segmentfault.com/a/1190000017560688
            // https://zhuanlan.zhihu.com/p/269853186
            window.addEventListener("popstate", (event) => {
                console.log(event);
                console.log(location.pathname, "location.hash");
                go(location.pathname);
            });

            // hash模式与history的区别

            // hash模式刷新页面不会出问题，但是很丑陋  history API模式在当前路由下可能会报404(可以查看控制台),因为找不到当前路径,
            // 所以呢，你要在服务端增加一个覆盖所有情况的候选资源:如果URL匹配不到任何静态资源,则应该返回同一个index.html页面
            // 当浏览器刷新的时候要,通过location.href中找到对应的路由=>渲染对应的组件
            // https://router.vuejs.org/zh/guide/essentials/history-mode.html
        </script>
    </body>
</html>
